{
  "rules": {
    "users": {
      ".indexOn": ["firebaseUid", "email", "username", "role"],
      ".read": "auth != null",
      "$userId": {
        ".read": "auth != null && (auth.uid == data.child('firebaseUid').val() || auth.token.admin == true || auth.token.employee == true)",
        ".write": "auth != null && (auth.uid == data.child('firebaseUid').val() || auth.token.admin == true)",
        ".validate": "newData.hasChildren(['firebaseUid', 'username', 'role']) && newData.child('role').val().matches(/^(ADMIN|EMPLOYEE|CUSTOMER)$/)"
      }
    },
    "products": {
      ".indexOn": ["name", "price", "quantity", "shelfLocation"],
      ".read": "auth != null",
      ".write": "auth != null && (auth.token.admin == true || auth.token.employee == true)",
      "$productId": {
        ".validate": "newData.hasChildren(['name', 'price', 'quantity', 'cost']) && newData.child('price').isString() && newData.child('cost').isString() && newData.child('quantity').isNumber()"
      }
    },
    "cart_items": {
      ".indexOn": ["firebaseUid", "productId", "timestamp"],
      ".read": "auth != null",
      "$cartItemId": {
        ".read": "auth != null && (auth.uid == data.child('firebaseUid').val() || auth.token.admin == true || auth.token.employee == true)",
        ".write": "auth != null && (auth.uid == data.child('firebaseUid').val() || auth.token.admin == true)",
        ".validate": "newData.hasChildren(['firebaseUid', 'productId', 'quantity']) && newData.child('quantity').isNumber() && newData.child('quantity').val() > 0"
      }
    },
    "sales": {
      ".indexOn": ["customerId", "employeeId", "timestamp", "status"],
      ".read": "auth != null && (auth.token.admin == true || auth.token.employee == true)",
      ".write": "auth != null && (auth.token.admin == true || auth.token.employee == true)",
      "$saleId": {
        ".validate": "newData.hasChildren(['customerId', 'employeeId', 'items', 'totalAmount', 'timestamp', 'status']) && newData.child('totalAmount').isString() && newData.child('timestamp').isNumber()"
      }
    },
    "returns": {
      ".indexOn": ["saleId", "customerId", "timestamp", "status"],
      ".read": "auth != null && (auth.token.admin == true || auth.token.employee == true)",
      ".write": "auth != null && (auth.token.admin == true || auth.token.employee == true)",
      "$returnId": {
        ".validate": "newData.hasChildren(['saleId', 'customerId', 'reason', 'timestamp', 'status']) && newData.child('timestamp').isNumber()"
      }
    },
    "analytics": {
      ".read": "auth != null && auth.token.admin == true",
      ".write": "auth != null && auth.token.admin == true"
    }
  }
}
